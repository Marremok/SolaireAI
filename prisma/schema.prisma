// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}


model User {
  id            Int     @id @default(autoincrement())
  clerkId       String  @unique
  email         String  @unique
  firstName     String
  lastName      String
  phone         String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Rest & recovery settings
  restDays      String[]  @default([])

  // Subject-color mapping
  subjects      Json      @default("[]")

  exams         Exam[]
  studySessions StudySession[]

  @@map("users")
}



model Exam {
  id            Int       @id
  userId        Int
  title         String
  subject       String?
  studyMethods  Json
  preferences   String?
  date          DateTime
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  targetSessionsPerWeek Int
  sessionLengthMinutes  Int      @default(60)
  whenToStartStudying   String   @default("tomorrow")
  status        ExamStatus  @default(UPCOMING)

  user          User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  studySessions StudySession[]
  scheduleStatus ScheduleStatus @default(NONE)

  @@map("exams")
}

enum ExamStatus {
  UPCOMING
  COMPLETED
}

enum ScheduleStatus {
  NONE
  GENERATING
  GENERATED
  FAILED
}

enum SessionStatus {
  PLANNED
  COMPLETED
  SKIPPED
}

model StudySession {
  id        Int           @id @default(autoincrement())
  examId    Int
  userId   Int
  date      DateTime
  duration  Int
  method    String
  topic     String?
  status    SessionStatus @default(PLANNED)
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt

  exam      Exam          @relation(fields: [examId], references: [id], onDelete: Cascade)
  user      User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("study_sessions")
}
